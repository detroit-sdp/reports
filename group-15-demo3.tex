%% Template for SDP report, adapted from mlp_cw2_template, 2018. 

%% Based on  LaTeX template for ICML 2017 - example_paper.tex at 
%%  https://2017.icml.cc/Conferences/2017/StyleAuthorInstructions

\documentclass{article}
\input{mlp2018_includes}

%% You probably do not need to change anything above this comment

%% REPLACE the details in the following commands with your details
\setGroupNumber{15}
\setGroupName{Detroit}
\setProductName{Tadashi}
\setDemoNumber{3}
\setLogoFileName{figs/logo-small.png}

\begin{document} 

\makeSDPTitle{Demo}

% Previous MLP Style Title Layout working. 
% \twocolumn[
    % \mlptitle{\productName: SDP Demo \demoNumber}
    % \centerline{Group \groupNumber: \groupName}
% ]

\begin{abstract}
  Tadashi is an assistive robot for delivering food and water to residents in supported living and care home environments.
The abstract should consist of one sentence describing the intended functionality of your system, followed by a few sentences (100--200 words) summarising the key advances made for this demo. This should give the reader a clear expectation of what will be demonstrated.
\end{abstract} 

\section{Project plan update} 
\begin{itemize}
\item Begin testing app with non-technical users to gain insights on accessibility and ease of use: {\bf achieved}.
\item Make changes to app justified against results of testing: {\bf partially achieved}.
\item Complete user interviews with caregivers to assess demand for project features and implement new features based on caregiver requests: {\bf not achieved}.
\item Physically integrate lift mechanism into robot body, and integrate lift control into robot control software: {\bf achieved}.
\item Design and manufacture a tray to place on top of the lift to hold items: {\bf achieved}.
\item Add sensor to lift to determine whether items have been removed: {\bf achieved}.
\item Refine robot problem-solving when stuck by tuning mapping sensitivity and obstacle avoidance logic: {\bf partially achieved}. 
\item Implement bi-directional communication between the app and robot: {\bf achieved}.
\end{itemize}

We were not able to complete user interviews because strikes delayed ethical approval. We are hoping to receive ethical approval before the next demo, so this goal has been moved to demo 4. For robot problem solving, we were 

Provide a one paragraph description of how your group organised the work towards the goals, including specific indication of which group member worked on which aspect(s). Highlight any methods used to ensure effective group work such as protocols for code integration, task tracking, automated testing, etc.

Provide a summary of how your budget has been spent so far.

Provide a clear statement of any modification (relative to your original plan) that you wish to make to your goals for the next demonstration.

\section{Technical details}

This section should describe in technical terms the current status of your system implementation. It should provide clear justification for any design decisions, with brief reference to any alternatives considered or explored. If your implementation is based on the work of others (e.g. you have found a specific vision processing algorithm) you should cite the source (e.g. \cite{Newell81}) and add the details to the example-refs.bib file so that the full reference appears in the bibliography section. Note you can also refer back to your own previous reports. 

You can export references in the bibtex format from Google Scholar. Click the quotation marks underneath the study name, click 'Bibtex' in the new popup. You can then copy and paste this code into example-refs.bib.

The following are some suggested subsections. You might also want to include a system overview diagram showing how all the relevant parts connect. 

\subsection{Hardware}

Explain any construction on the hardware parts of your system, including choice and placement of sensors and actuators. Pictures should be used if appropriate (for instance, figure~\ref{fig:sample-fig}), using the \verb+\includegraphics+ environment to include an image (pdf, png, or jpg formats), ideally with informative labels added. 

To keep your folders clean, it is often a good idea to keep your images in a separate folder. In this example, we've put the figures in the \texttt{figs/} folder. To include images from different folders, give the relative path from this file. Example: \verb+\includegraphics{figs/image_filename}+.

\subsection{User interface}

Depending on your system and its stage of development, it could be useful to include a section about the user interface design, and the usability decisions behind it. Note, however, that you will be asked to provide a separate 'user guide' for the final demo.

\subsection{Software}

From its state in the previous demo, the robot software has moved towards what would have been our envisaged final product. In summary, it has evolved in the following key ways:

\begin{itemize}
  \item The robot now keeps track of a variety of variables regarding its state
  \item The robot now calculates a vector to its intended destination from its current position rather than using hardcoded distances on x and y
  \item The parameters powering the robots autonomous navigation have been configured in order to suit our configuration more appropriately
  \item The robot can now control the lift directly through a serial connection between the Raspberry Pi board and the arduino controlling the lift
  \item The ROS node controlling the navigation stack and networking is now able to communicate with the app bidirectionally
\end{itemize}

%Item 1
For obvious reasons, we wanted the app to be able to access certain information about the current state of our robot. The information we decided would be particularly important is the state of its battery, as well as its current 'behaviour'. These different status' are stored in a dictionary. We decided to use a dictionary over a list so that we could assign our own code to each state. This would be useful later on if we were to implement some kind of error recognition i.e. {\it def a} should not run if the state is less than 0. We note that in the average case, item retreival is O(1) in both lists and dictionaries and so there was no obvious reason against using a dictionary here given this is all we use ours for. The states we had included at this stage were: low battery, assistance required, at base/not busy, moving, and arrived at goal.

% Item 2
At any given moment the robot knows both its own position (with respect to where it was booted up) and the map (again, placing itself in the origin on startup). The starting position can be altered. However, we decided to map our space beginning at the 'base' meaning that this is the origin on our map. Every time we start up the robot it is started in this position. In the real world, the base would be the area where the robot is loaded and charged.

The navigation stack takes a goal in and calculates the path to this goal. The goal is not a set of coordinates in the map, but a pair of distances on the x and y axes and a rotation at this goal. If you were to always start at the same location facing the same direction, this would function the same as if you were to give it a set of coordinates. The problem is that you are not always moving from the same base due to goal tolerance allowing for some specified inaccuracy in order to save time, as well as natural drift. In order to correct this, we decided to have our robot take in the coordinates of the goal and calculate the vector from its current position.

As a further complication, the robot always believes that it is facing forwards. That is, while you can specify a rotational movement using a quaternion (x,y,z,w), the robot will always think of its own rotation as being forward or (0,0,0,1). This means that the axes rotate with the robot in its own mind. Due to the obvious difficulties this presents when calculating our way back to base, we decided to restrict the robot to a four-directional goal system - forwards, backwards, right, and left with each having its own rotational movement (Table~\ref{tab:quaternions}).

With all this in mind, we store our room coordinates in another dictionary in Python. Before, the time complexity was not different between list and dictionary. This is not the case for the room dictionary as while retreival is still a key operation on the room dictionary, lookup is also important in order to verify if the room actually exists for error detection. Lookup, insertion, and deletion are O(n) in the average case for lists, but are O(1) for dictionaries. There is a clear advantage in us using dictionaries over lists here. This is not to mention that fact that it allows us to index the rooms however we please. Each entry in the dictionary stores the coordinates of the room, and the targeted rotation at this goal (L,B,F, or R).

Our initial test runs of the code seemed to indicate that using the coordinates-vector system is unsurprisingly far more accurate over time than using distances. Due to the team not feeling comfortable returning to Appleton Tower in the wake of the global COVID-19 pandemic, we were not able to carry out any official tests on this. Our plans are detailed in Evaluation section.

\begin{table}[h]
\vskip 3mm
\begin{center}
\begin{small}
\begin{sc}
\begin{tabular}{lcccc}
\hline
\abovespace\belowspace
Direction & x & y & z & w \\
\hline
  Forward & 0 & 0 & 0 & 1\\
  Backwards & 0 & 0 & 1 & 0 \\
  Right & 0 & 0 & -0.7071 & 0.7071 \\
  Left & 0 & 0 & 0.7071 & 0.7071 
\end{tabular}
\end{sc}
\end{small}
\caption{Quaternion movement inputs for each direction.}
\label{tab:quaternions}
\end{center}
\vskip -3mm
\end{table}

% Item 3
After we located the parameter files for the navigation stack, we altered them to suit our configuration more appropriately. We found a parameter under the robots description of itself that it provides to the stack named <collision>...</collision>. This seems to be the parameter the stack uses in order to avoid collision between the world and the robot. Furthermore, this xrdf tag features an attribute <box size> which was set on default to values very closely resembling the dimensions of the Turtlebot. We altered this to match the new dimensions of our bot. Specfically, the length of our bot is approximately 40.0cm as opposed to the original 28.1cm. Unfortunately, this is something that is incredibly difficult to test due to the robot avoiding obstacles very conservatively as a result of the parameter changes below.

The other key parameters are mostly self-explanatory other than the following. [min/max]\_trans\_vel is the speed of the robot when moving in a straight line. path\_distance\_bias determines how closely the robot need follow the path it works out. Given our robot always calculated an accurate path, we increased this value. goal\_distance\_bias smoothes the trajectory of the path and makes it more efficient. Again, we decided to increase this. Finally, occdist\_scale determines how 'afraid' the robot is of obstacles. We lowered this to make it behave a little safer. All our parameter changes are detailed in table~\ref{tab:params}. Our parameters - like our coordinate system - have not been formally tested due to the same reasons as the coordinate system. Much like the coordinate system, initial inspection by observation would suggest to us that our parameters are far better for us.

\begin{table}[h]
\vskip 3mm
\begin{center}
\begin{small}
\begin{sc}
\begin{tabular}{lcc}
\hline
\abovespace\belowspace
Parameters & Original value & Our value \\
\hline
  max\_vel\_x & 0.26 & 0.1 \\
  min\_vel\_x & -0.26 & -0.1 \\
  max\_trans\_vel & 0.26 & 0.1 \\
  min\_trans\_vel & 0.13 & 0.07 \\
  max\_rot\_vel & 1.82 & 1.3 \\
  xy\_goal\_tolerance & 0.05 & 0.175 \\
  path\_distance\_bias & 32.0 & 65.0 \\
  goal\_distance\_bias & 20.0 & 40.0 \\
  occdist\_scale & 0.02 & 0.01
\end{tabular}
\end{sc}
\end{small}
\caption{Our parameter alterations.}
\label{tab:params}
\end{center}
\vskip -3mm
\end{table}

% Item 4

% Item 5
Most of the work in terms of getting the bidirectional connectivity established with the app was done on the app side. Once they were able to forward packets from the host machine to the emulator, our job was to handle the sending of UDP packets to the app when appropriate. We discussed why UDP was used in previous demos and reports, but briefly, it was because there was no need for a formal connection to be held between the app and the robot. Due to the fact we were sending a single packet at any given time, packet loss is also a non-issue for our system. The system returns a packet to the app whenever the state changes. The packet simply contains one of the messages listed above and any logic for the handling of them happens on the app side. As mentioned in previous reports, we had to route the packets through the Turtlebot due to - what we believe to be - dynamic NAT being disabled on the sdp-robots router.

\section{Evaluation}

This section should first outline any testing methods you used (e.g. repeated runs of subsystems, data-logging, naive user testing). 

It should then present relevant quantitative results. If you are using graphs, please make sure they are properly labelled and logically illustrate the point you want to make (e.g. to compare two algorithms).


At an absolute minimum, this section should provide a table (for instance, table~\ref{tab:sample-table}, using the \verb+table+ environment) of success rates for repeated runs of the whole system (as you will only be able to show one run in the demo).

\begin{table}[h]
\vskip 3mm
\begin{center}
\begin{small}
\begin{sc}
\begin{tabular}{lcccr}
\hline
\abovespace\belowspace
Test  & Time(mins) & Errors & Success \\
\hline
\abovespace
1    & 1:30 & 0 & $\surd$ \\
2    & 3:00 & 2 & $\times$\\
3    & 2:20 & 1 & $\surd$ \\
4    & 1:50 & 1 & $\times$\\
\belowspace
5    & 2:10 & 0 & $\surd$ \\
\hline
\end{tabular}
\end{sc}
\end{small}
\caption{Results for 5 tests of the system.}
\label{tab:sample-table}
\end{center}
\vskip -3mm
\end{table}

If you need a figure or table to stretch across two columns use the \verb+figure*+ or \verb+table*+ environment instead of the \verb+figure+ or \verb+table+ environment.  Use the \verb+subfigure+ environment if you want to include multiple graphics in a single figure.

\section{Budget}

\begin{table}[h]
\begin{center}
    \resizebox{\columnwidth}{!}{
  \begin{tabular}{lllll}
    {\bf Item} & {\bf Units} & {\bf Cost (\pounds\ per unit)} & {\bf Total cost (\pounds)} & {\bf Use} \\
    \hline
    Turtlebot Waffle & 1 & 1275.80 & 1275.80 & Robot \\
    Lego & 2.5kg & 15.00 & 37.50 & Lift \\
    Arduino kit & 1 & 60.00 & 60.00 & Lift \\
    \hline \hline
               &       & Overall cost (\pounds) & 1373.3
  \end{tabular}}
\caption{Non-budgeted monetary costs at demo \demoNumber. }
\label{tab:non-budget-cost}
\end{center}
\end{table}

\begin{table}[h]
\begin{center}
  \resizebox{\columnwidth}{!}{
  \begin{tabular}{lllll}
    {\bf Item} & {\bf Total cost (\pounds)} & {\bf Use} \\
    \hline
    Turtlebot supports  & 8.00 & Lift \\
    MDF support (12mm x 270mm x 400mm) & 1.00  & Lift \\ 
    Lift support rods & 5.00 & Lift \\
    Pegboard ($0.62 \text{m}^2$ at \pounds 12 per $2.88 \text{m}^2$)& 2.59 & Arena \\
    Misc (wires, screws, angle brackets) & 10.00 & Lift, arena \\
    MDF support (6 x 350  x 230mm) & 0.30 & Lift \\
    MDF support (9 x 70 x 230mm, 9 x 10 x 250mm (2x)) & 0.10 & Lift \\
    Engraved tray & 5.80 & Lift \\
    Weight sensors (2x) & 19.60 & Lift \\
    \hline
    \hline
     Budget spent (\pounds) & 52.39 \\
     Budget remaining (\pounds) & 147.61
  \end{tabular}}
\caption{Budgeted monetary costs at demo \demoNumber. MDF value is approximate as 12mm MDF is not on the SDP price sheet.}
\label{tab:budget-cost-monetary}
\end{center}
\end{table}

\begin{table}[h]
\begin{center}
  \resizebox{\columnwidth}{!}{
  \begin{tabular}{lll}
    {\bf Purpose} & {\bf Hours spent} & {\bf Use} \\
    \hline
    Manufacturing lift support rods & 1 & Lift \\
    Manufacturing lift base (MDF) & 0.5 & Lift \\
    Drilling holes in lift base & 0.25 & Lift \\
    Engraving tray & 1 & Lift \\
    Attaching lift to base & 1 & Lift \\
    Cutting MDF to mount lift to base & 1 & Lift \\
    \hline
    \hline
    Overall technician hours spent & 4.75 & \\
    Total technician hours remaining & 1.25
  \end{tabular}}
\caption{Budgeted technician time at demo \demoNumber. Note that hours remaining includes subtracting any hours lost due to not being used in previous weeks.}
\label{tab:budget-cost-non-monetary}
\end{center}
\end{table}


%% Include any references in a bibliography

\bibliography{example-refs}

\end{document} 

